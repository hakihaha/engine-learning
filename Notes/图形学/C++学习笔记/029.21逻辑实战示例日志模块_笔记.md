#### 一、实战日志模块﻿00:00﻿

##### 1. 需求说明﻿00:25﻿

- ![](https://bdct01.baidupcs.com/file/p-c526c0549c32987f014bf931a131c3ca-40-2025042100-1?bkt=en-3de6f374fcad9f514a94920d227b7f50&fid=282335-250528-&time=1766323742&sign=FDTAXUVGEQlBHSKfWqij-GBWOGYTBgG0KqHy7wNbwoLTVMyJyK6xE-0ryRonHgxnuhsuD8g1jbCSq13Co%3D&to=139&size=10&sta_dx=10&sta_cs=0&sta_ft=&sta_ct=7&sta_mt=7&fm2=MH%2CBaoding%2CAnywhere%2C%2C%E5%B9%BF%E4%B8%9C%2Cct&ctime=0&mtime=0&dt3=0&resv0=-1&resv1=0&resv2=rlim&resv3=5&resv4=10&vuk=0&iv=2&vl=0&htype=&randtype=&newver=1&newfm=1&secfm=1&flow_ver=3&pkey=en-a8237f987e1e8801a49c3114c663234ca7f189fad75b681e05ef47221e8177b18a5080fcd0d766a9d32ce44c9faeab4bd3717271d4f23316305a5e1275657320&expires=8h&r=852206655&vbdid=-&fin=p-c526c0549c32987f014bf931a131c3ca-40-2025042100-1&fn=p-c526c0549c32987f014bf931a131c3ca-40-2025042100-1&rtype=1&dp-logid=160570292318295161&dp-callid=0.1&hps=1&tsl=0&csl=0&fsl=-1&csign=dmayhhcqdS1jXSxjkf6DN1P7N8o%3D&so=0&ut=1&uter=-1&serv=-1&uc=1165386203&ti=7717645f262844ca627e1d822ff1263bb24ba313372ce79d&hflag=30&from_type=&adg=n&reqlabel=250528_n_505d42acb386d633565a8a308d8cf49c_0_be62cc6764b57c8da65e5dc7463d3d5c&chkv=5&bid=250528&by=themis)
- 核心功能：用户能够控制显示日志的最高级别
- 应用场景：
    - 生产环境需要关闭debug级日志以提升性能
    - 系统出问题时需要打开日志进行调试
- 实现方式：通过main函数传递参数来控制日志级别
- 日志重要性：为工程人员提供系统运行状态和问题排查依据

###### 1）测试说明﻿01:50﻿

- ![](https://bdct01.baidupcs.com/file/p-c526c0549c32987f014bf931a131c3ca-40-2025042100-2?bkt=en-3de6f374fcad9f514a94920d227b7f50&fid=282335-250528-&time=1766323742&sign=FDTAXUVGEQlBHSKfWqij-GBWOGYTBgG0KqHy7wNbwoLTVMyJyK6xE-Tgy0sEQjZqqLpNGoZIiqYtjhzdc%3D&to=139&size=10&sta_dx=10&sta_cs=0&sta_ft=&sta_ct=7&sta_mt=7&fm2=MH%2CBaoding%2CAnywhere%2C%2C%E5%B9%BF%E4%B8%9C%2Cct&ctime=0&mtime=0&dt3=0&resv0=-1&resv1=0&resv2=rlim&resv3=5&resv4=10&vuk=0&iv=2&vl=0&htype=&randtype=&newver=1&newfm=1&secfm=1&flow_ver=3&pkey=en-9fe6cb3eeeb93b6e09f886798703ab5d3d2df60c17c23f9aef15368ffe0cd38b0f669d33e13a393645aab7b9ffe731eb8566e190f1253581305a5e1275657320&expires=8h&r=467443686&vbdid=-&fin=p-c526c0549c32987f014bf931a131c3ca-40-2025042100-2&fn=p-c526c0549c32987f014bf931a131c3ca-40-2025042100-2&rtype=1&dp-logid=160570292318295161&dp-callid=0.1&hps=1&tsl=0&csl=0&fsl=-1&csign=dmayhhcqdS1jXSxjkf6DN1P7N8o%3D&so=0&ut=1&uter=-1&serv=-1&uc=1165386203&ti=718800a01e5121ca8395a30becffee92b24ba313372ce79d&hflag=30&from_type=&adg=n&reqlabel=250528_n_505d42acb386d633565a8a308d8cf49c_0_be62cc6764b57c8da65e5dc7463d3d5c&chkv=5&bid=250528&by=themis)
- 日志级别枚举：
    - DEBUG(0)：调试信息
    - INFO(1)：正常信息
    - ERROR(2)：普通错误
    - FATAL(3)：导致程序退出的严重错误
- 级别特性：数值越大级别越高，高优先级日志应优先显示
- 测试原则：采用测试先行开发模式，先设计测试用例再编码
- ![](https://bdct01.baidupcs.com/file/p-c526c0549c32987f014bf931a131c3ca-40-2025042100-3?bkt=en-3de6f374fcad9f514a94920d227b7f50&fid=282335-250528-&time=1766323742&sign=FDTAXUVGEQlBHSKfWqij-GBWOGYTBgG0KqHy7wNbwoLTVMyJyK6xE-3IEtYQKyHIxF50uAghZT8lAQ7OY%3D&to=139&size=10&sta_dx=10&sta_cs=0&sta_ft=&sta_ct=7&sta_mt=7&fm2=MH%2CBaoding%2CAnywhere%2C%2C%E5%B9%BF%E4%B8%9C%2Cct&ctime=0&mtime=0&dt3=0&resv0=-1&resv1=0&resv2=rlim&resv3=5&resv4=10&vuk=0&iv=2&vl=0&htype=&randtype=&newver=1&newfm=1&secfm=1&flow_ver=3&pkey=en-e512a223ac19cd308650ad29aba3f2a4a02c443d8b66961f3846452370d0796124ccd831a0b89fc087d58721e7a5fd6f8981a5cabc493a5c305a5e1275657320&expires=8h&r=100168152&vbdid=-&fin=p-c526c0549c32987f014bf931a131c3ca-40-2025042100-3&fn=p-c526c0549c32987f014bf931a131c3ca-40-2025042100-3&rtype=1&dp-logid=160570292318295161&dp-callid=0.1&hps=1&tsl=0&csl=0&fsl=-1&csign=dmayhhcqdS1jXSxjkf6DN1P7N8o%3D&so=0&ut=1&uter=-1&serv=-1&uc=1165386203&ti=7717645f262844ca47d25416b3a763ad4eca14d9ab8645e2&hflag=30&from_type=&adg=n&reqlabel=250528_n_505d42acb386d633565a8a308d8cf49c_0_be62cc6764b57c8da65e5dc7463d3d5c&chkv=5&bid=250528&by=themis)
- 测试数据：
    - DEBUG: test debug log
    - INFO: test info log
    - ERROR: test error log
    - FATAL: test fatal log
- 测试逻辑：用户输入不同级别时，应显示该级别及以上的所有日志

###### 2）实战日志模块﻿02:51﻿

- 用户传递最低显示日志级别﻿03:21﻿
    - ![](https://bdct01.baidupcs.com/file/p-c526c0549c32987f014bf931a131c3ca-40-2025042100-4?bkt=en-3de6f374fcad9f514a94920d227b7f50&fid=282335-250528-&time=1766323742&sign=FDTAXUVGEQlBHSKfWqij-GBWOGYTBgG0KqHy7wNbwoLTVMyJyK6xE-LHoPi8et52Guqwt2qjYbK1qyz6o%3D&to=139&size=10&sta_dx=10&sta_cs=0&sta_ft=&sta_ct=7&sta_mt=7&fm2=MH%2CBaoding%2CAnywhere%2C%2C%E5%B9%BF%E4%B8%9C%2Cct&ctime=0&mtime=0&dt3=0&resv0=-1&resv1=0&resv2=rlim&resv3=5&resv4=10&vuk=0&iv=2&vl=0&htype=&randtype=&newver=1&newfm=1&secfm=1&flow_ver=3&pkey=en-185032bc49f8eb2b55e4590d6a66a19ab56f1854a41825d60ea20e0048419cb5020f185271c2f135308010afe1269d6e3d9209a04c2789a0305a5e1275657320&expires=8h&r=545997517&vbdid=-&fin=p-c526c0549c32987f014bf931a131c3ca-40-2025042100-4&fn=p-c526c0549c32987f014bf931a131c3ca-40-2025042100-4&rtype=1&dp-logid=160570292318295161&dp-callid=0.1&hps=1&tsl=0&csl=0&fsl=-1&csign=dmayhhcqdS1jXSxjkf6DN1P7N8o%3D&so=0&ut=1&uter=-1&serv=-1&uc=1165386203&ti=718800a01e5121ca44342240fa99746fee1d682c7e1ac240305a5e1275657320&hflag=30&from_type=&adg=n&reqlabel=250528_n_505d42acb386d633565a8a308d8cf49c_0_be62cc6764b57c8da65e5dc7463d3d5c&chkv=5&bid=250528&by=themis)
    - 默认设置：
        - 默认显示DEBUG及以上所有日志
        - 级别顺序：DEBUG < INFO < ERROR < FATAL
    - 参数处理：
        - 通过main(int argc, char* argv[])接收参数
        - 需处理用户不传参数的情况
        - 参数值转换为枚举类型LogLevel
- 代码实现﻿05:28﻿
    - 枚举定义﻿07:05﻿

enum class LogLevel {
    DEBUG,
    INFO,
    ERROR,
    FATAL
};

- 参数解析

auto logLevel = LogLevel::DEBUG; // 默认值
if(argc > 1) {
    string levelStr = argv[1]; // 用户设置的日志级别
    if("info" == levelStr) logLevel = LogLevel::INFO;
    else if("error" == levelStr) logLevel = LogLevel::ERROR;
    else if("fatal" == levelStr) logLevel = LogLevel::FATAL;
}

- 日志打印逻辑﻿11:45﻿

LogLevel level = LogLevel::DEBUG; // 当前日志级别
string context = "test log 1"; // 日志内容
if(level >= logLevel) { // 级别判断
    string levelStr = "debug";
    if(LogLevel::INFO == level) levelStr = "info";
    else if(LogLevel::ERROR == level) levelStr = "error";
    else if(LogLevel::FATAL == level) levelStr = "fatal";
    cout << levelStr + ":" << context << endl;
}

- 测试验证﻿17:17﻿
    - 测试方法：通过项目属性设置命令行参数
    - 测试用例：
        - 不传参数：显示所有日志
        - 传"info"：显示INFO及以上日志
        - 传"error"：显示ERROR及以上日志
        - 传"fatal"：仅显示FATAL日志
- 代码优化方向﻿19:44﻿
    - 当前问题：存在重复代码块，日志打印逻辑重复4次
    - 优化方案：
        - 后续使用函数封装重复代码
        - 使用数组或map优化字符串与枚举的转换
        - 添加更多日志信息（时间戳、线程ID等）

#### 二、知识小结

|   |   |   |   |
|---|---|---|---|
|知识点|核心内容|考试重点/易混淆点|难度系数|
|日志模块设计|通过枚举类型定义日志级别（DEBUG/INFO/ERROR/FATAL），用户通过命令行参数控制显示的最低日志级别|枚举值与级别的对应关系（0=DEBUG，3=FATAL）|⭐⭐|
|参数传递逻辑|通过argc/argv读取用户输入，默认显示DEBUG级别，动态调整日志过滤阈值|参数校验逻辑（未传参时使用默认值）|⭐⭐|
|日志级别判断|通过if-else链实现枚举值与字符串的双向转换，比较日志级别是否≥用户设定值|层级关系判断（>=而非==）|⭐⭐⭐|
|测试驱动开发|准备四条测试日志（各级别一条），验证参数过滤效果|重复代码块 vs 未来函数封装优化|⭐⭐|
|枚举类型应用|使用enum class定义日志级别，避免数值与类型的隐式转换|枚举作用域限定（需显式指定LogLevel::DEBUG）|⭐|