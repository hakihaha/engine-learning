
![](https://thumbnail0.baidupcs.com/thumbnail/80a3d956buf91b14e139eb758299f274?chkbd=0&chkv=0&dp-callid=0&dp-logid=2623880903158990704&expires=8h&fid=1653526243-250528-887808583037625&ft=image&quality=100&rt=pr&sign=FDTAER-DCb740ccc5511e5e8fedcff06b081203-FXTgQiIzTS4XS%2FVZiX7bsotAC%2Bg%3D&size=c1080_u1080&time=1766415600&vuk=1653526243)

#### 一、while实战shell﻿00:05﻿

##### 1.system执行系统命令

###### 1) 函数介绍﻿00:55﻿

- system函数功能：执行系统命令，类似于在控制台输入命令。
- 平台差异：system命令在WINDOWS和linux系统中的实现不同。
- 返回值处理：system函数的返回值通常不包含有用的信息，可以忽略。
- 参数类型：system函数接受一个const char*类型的参数，即要执行的命令字符串。
- 预处理代码：后续章节会讲解如何使用宏预处理代码来处理不同平台的差异。
- 当前假设：现阶段代码示例假设运行在WINDOWS平台。
- 函数调用：通过system("command")的形式调用系统命令。

###### 2) 执行CD命令﻿01:20﻿

- CD命令功能：显示或更改当前目录路径
- system函数应用：用于执行系统命令如pause
- 跨平台差异：Windows和Linux系统命令存在区别
- 命令执行演示：通过控制台直接输入CD查看当前路径
- 暂停命令：使用system("pause")实现程序暂停功能
- 头文件关联：iostream已包含基础命令所需头文件
- 命令操作步骤：打开控制台→输入CD→显示当前目录

###### 3) 执行DIR命令🌟﻿02:39﻿

- DIR命令功能：用于显示当前目录下的文件和子目录。
- string存储命令：使用string类型存储DIR命令便于字符串拼接和管理。
- system函数调用：通过system函数执行存储在string中的DIR命令。
- c_str方法：使用string的c_str方法将字符串转换为const char*以兼容system函数。
- 性能说明：c_str转换无额外性能开销，直接返回内部内存地址。
- 命令执行示例：演示了DIR命令的执行效果和输出内容。
- 字符串拼接优势：相比const char*，string更便于命令的拼接和修改。
- 编译优化：使用string在编译优化后效率较高。

###### 4) 接收用户输入命令﻿04:29﻿

- 命令接收:通过打印内容提示用户输入命令
- 命令执行:使用system函数将用户输入传递给cmd执行
- 单次执行:当前实现仅支持单次命令输入执行
- 多次执行:需要考虑如何处理连续多次命令输入的情况
- 命令验证:打印实际执行的命令内容进行验证
- 目录操作:演示了cd和dir等目录操作命令的执行效果
- 调试技巧:通过打印中间结果来验证命令执行过程

###### 5) 打印用户输入命令﻿05:55﻿

- 命令打印：在system之前打印用户输入的命令。
- 命令执行：实际执行的命令是DIR，未存储后续参数。
- 参数处理：只获取第一个参数（如dll），忽略后续参数（如C盘）。
- 多参数支持：需要同时支持DIR和dirc盘两种命令格式。
- 字符串分隔：以空格分隔的字符串，只取第一个值。
- 内存处理：获取一行数据涉及内存处理，需考虑效率。
- 逻辑方案：通过多次获取实现多参数支持。
- 需求明确：需同时支持用户输入dll和dllc盘两种命令版本。

###### 6) 判断cin中是否有数据未取🌟🌟﻿07:13﻿

- 缓冲区判断：通过cin.rdbuf()检查输入缓冲区中是否还有未读取的数据。
- 数据读取步骤：第一次读取DIR，第二次读取C盘，需要判断缓冲区是否还有剩余数据。
- 代码实现：使用cout打印未读取的数据，通过cin对象指针访问相关函数。
- 两种情况：缓冲区中可能还有未读取的数据，需要分别处理。
- 命令解析：输入的命令以空格分隔，第一次调用cin只能读取部分内容。
- 指针操作：通过对象指针访问函数，获取缓冲区中的未读取数据。
- 后续讲解：现阶段只需记住固定代码即可，详细原理会在后续课程中讲解。

###### 7) 测试用户输入命令﻿09:13﻿

- DIR命令测试：演示直接输入DIR命令查看缓冲区内容
- 缓冲区读取：说明缓冲区中存在未读取内容（如换行符）
- 输入结束判断：当返回值等于1时表示用户输入结束
- 缓冲区状态判断：返回值大于1表示缓冲区仍有未读取内容
- 回车键功能：用户按回车键确认输入内容
- 换行符处理：解释缓冲区中换行符的存在及其影响
- 重复读取策略：建议当缓冲区有内容时可再次读取

###### 8) string取命令﻿10:38﻿

- 字符串操作：使用temp变量进行字符串取值
- 命令拼接：cmd变量通过"cmd+空格+t"方式构建
- 代码测试流程：先编写代码再测试分析结果
- 变量赋值：通过
    
    ﻿cmd=cmd+""+tcmd = cmd + " " + tcmd=cmd+""+t﻿
    
    实现字符串拼接

###### 9) 测试用户输入命令🌟🌟🌟﻿10:55﻿

- 命令测试方法:DIR命令的两种测试情况（直接输入DIR和输入d irc盘）
- 参数处理逻辑:通过空格分割用户输入内容，获取命令和参数
- 缓冲区处理:当缓冲区内容大于1时进行二次取值和拼接
- 路径拼接技巧:DIR命令与路径参数的空格拼接方式（如"DIR c:"）
- 转义字符问题:斜杠需要双写避免编码问题（如"\"代替""）
- 作用域管理:string变量的作用域限制在大括号范围内
- 执行流程:先处理命令再处理参数，最后拼接执行